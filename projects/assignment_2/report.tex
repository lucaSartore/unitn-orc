\documentclass[12pt]{article}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{geometry}
\usepackage{float}
\geometry{margin=0.5in}

\title{Optimization and Learning for Robot Control: Assignment 2}
\author{Luca Sartore - 256154}
\date{}


\begin{document}
\maketitle

\tableofcontents
% ############################ part 1 ##############################
\newpage
\section{Path Tracking}

In this first experiment, we see how the simplest form of path tracking performs, as a baseline.

\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/base/s_vs_time.png} &   \includegraphics[width=80mm]{images/base/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/base/joint_velocity.png} &   \includegraphics[width=80mm]{images/base/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/base/ee_path.png} &   \includegraphics[width=80mm]{images/base/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/base/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Path Tracking''}
\end{figure}


\subsection{Observation on results}

We can see in sub-figures \textbf{e} and \textbf{f} that the tracking is perfect (as we would expect from path tracking).

From the sub-figures \textbf{a} and \textbf{b}, we can instead note that the optimizer has decided to go slower (aka having a lower
\textbf{w} value) at the beginning and at the end of the movement. These seem to be the most critical zones to guarantee good tracking.

% ############################ part 2 ##############################
\newpage

\section{Path Tracking + Cyclical Constrain}

In this experiment, we tried to make the robot perform a cyclical task by adding a penalty that minimizes the
difference between the initial state and the final state of the robot.


\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/cyclical/s_vs_time.png} &   \includegraphics[width=80mm]{images/cyclical/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/cyclical/joint_velocity.png} &   \includegraphics[width=80mm]{images/cyclical/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/cyclical/ee_path.png} &   \includegraphics[width=80mm]{images/cyclical/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/cyclical/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Path Tracking + Cyclical Constrain''}
\end{figure}

\subsection{Observation on results}

Here the results are mixed. The joint velocities are decent; in fact, we can see how
they approach zero by the end of the simulation. However, the
joint positions are not much different from those of the previous experiment,
indicating that the solver is not really able to end in the same position it started, while
also keeping perfect tracking (which is required, given in path tracking we use equality
constraints).

% ############################ part 3 ##############################
\newpage
\section{Trajectory Tracking + Cyclical Constrain}

In this section, we applied trajectory tracking instead of path tracking to observe the difference
with the previous experiment. We still maintained the so-called ``cyclical constraint''.


\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/trajectory-tracking/s_vs_time.png} &   \includegraphics[width=80mm]{images/trajectory-tracking/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/trajectory-tracking/joint_velocity.png} &   \includegraphics[width=80mm]{images/trajectory-tracking/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/trajectory-tracking/ee_path.png} &   \includegraphics[width=80mm]{images/trajectory-tracking/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/trajectory-tracking/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Trajectory Tracking + Cyclical Constrain''}
\end{figure}

\subsection{Observation on results}

Here we can see in sub-figure \textbf{e} how the tracking loses a bit of
accuracy. However, we can also see in the sub-figures \textbf{c} and \textbf{d}
how both joint velocity and joint position revert back to the original state
as the simulation approaches the end. This is because by choosing trajectory
tracking, we are allowing the robot to make smaller deviations from its original path,
and this makes it possible to optimize other tasks (such as the ``cyclical'' one).

To achieve this, we had to change the ``equality'' constraints on the path and make
them a ``cost''.
If we had left them as an equality while removing the flexibility of
selecting \textbf{w}, the optimizer would almost certainly fail (unless the tracking
task was trivial).

% ############################ part 4 ##############################
\newpage

\section{Path Tracking + Cyclical Constrain + Min Time Formulation}

In this experiment, we introduced a min-time Formulation constraint to the
previous path tracking task (by letting the solver optimize the time step).

\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/cyclical-min-time/s_vs_time.png} &   \includegraphics[width=80mm]{images/cyclical-min-time/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/cyclical-min-time/joint_velocity.png} &   \includegraphics[width=80mm]{images/cyclical-min-time/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/cyclical-min-time/ee_path.png} &   \includegraphics[width=80mm]{images/cyclical-min-time/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/cyclical-min-time/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Path Tracking + Cyclical Constrain + Min Time Formulation''}
\end{figure}

\subsection{Observation on results}

We can see how the results barely change from the previous path-tracking Formulation.
And the reason is easily understood by printing the time-step value after the optimization process.

We noted that the solver was actually taking more time than the previous Formulation
(using a time step of 24ms instead of 20).

The simple solution to this issue was to increase the weight of the running cost (see next section).



% ############################ part 5 ##############################
\newpage

\section{Path Tracking + Cyclical Constrain + Min Time Formulation + Tuned Weights}

This experiment has the same setup of the previous section, but the running cost's weight
was set to 1 instead of 0.1.


\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/cyclical-min-time-2/s_vs_time.png} &   \includegraphics[width=80mm]{images/cyclical-min-time-2/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/cyclical-min-time-2/joint_velocity.png} &   \includegraphics[width=80mm]{images/cyclical-min-time-2/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/cyclical-min-time-2/ee_path.png} &   \includegraphics[width=80mm]{images/cyclical-min-time-2/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/cyclical-min-time-2/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Path Tracking + Cyclical Constrain + Min Time Formulation + Tuned Weights''}
\end{figure}

\subsection{Observation on results}

Here the solver managed to complete the trajectory in a much quicker time,
as the time-step was optimized to be 14ms.
Here the charts look similar to the previous ones, with the only notable difference
being that the torques, accelerations, and velocities are all slightly higher,
indicating that the controller has decided to get a higher penalty
in the velocities, accelerations, and control inputs in order
to minimize the penalty on the time-step.



% ############################ part 6 ##############################
\newpage
\section{Trajectory Tracking + Cyclical Constrain + Min Time Formulation}

In this experiment, we apply the same min-time Formulation that we made in the previous
section to trajectory Tracking.

\subsection{Numerical results}
\begin{figure}[H]
\centering
\begin{tabular}{cc}
  \includegraphics[width=80mm]{images/trajectory-tracking-min-time/s_vs_time.png} &   \includegraphics[width=80mm]{images/trajectory-tracking-min-time/w_vs_time.png} \\
(a) The control variable ``s'' & (b) The control variable ``w'' \\[6pt]
 \includegraphics[width=80mm]{images/trajectory-tracking-min-time/joint_velocity.png} &   \includegraphics[width=80mm]{images/trajectory-tracking-min-time/joint_position.png} \\
(c) The joint velocity & (d) the joint position \\[6pt]
 \includegraphics[width=80mm]{images/trajectory-tracking-min-time/ee_path.png} &   \includegraphics[width=80mm]{images/trajectory-tracking-min-time/ee_pos_vs_time.png} \\
(e) Tracking on floor plane & (f) Tracking on X Y Z \\[6pt]
\multicolumn{2}{c}{\includegraphics[width=65mm]{images/trajectory-tracking-min-time/joint_torque.png} }\\
\multicolumn{2}{c}{(g) The joint torques}
\end{tabular}
\caption{experiment result of ``Trajectory Tracking + Cyclical Constrain + Min Time Formulation''}
\end{figure}

\subsection{Observation on results}

These are by far the best results we got.
We can see how the tracking is almost perfect, even though we are using trajectory tracking instead of path tracking.
The total time required to make the maneuver is also quite low (with a time-step that was around 6ms).

However, we can see from sub-plot \textbf{c} and \textbf{d} that the robot does not
return to the original state quite as well as our previous best result did.

Joint velocity and accelerations are higher than previous tests, but not extremely higher.
This may sound absurd at first, however, we can make sense of it by looking at the joint position
sub-plot \textbf{d}.
We see how this chart looks a bit different from the equivalent charts in previous experiments, and this implies that the robot is using a different
posture to achieve the task.
And we can assume that this posture is better for a quick execution.

Why the solver did not use this posture for previous optimization tasks is hard to say, as
solvers like the one we used often function as a ``black box''. However, we can hypothesize
that this configuration was not used in path tracking because it made it impossible to track perfectly,
and it also was not used during the previous trajectory tracking test, because the ``cyclical constraint''
had a higher weight relative to the others, and maybe this configuration was not chosen
because it provided a worse end position.


\end{document}